{{- if eq .include_job "yes"}}
# Job configuration for {{.project_name}}
resources:
  jobs:
    {{.project_name}}_job:
      name: {{.project_name}}_job

      {{- if eq .job_type "python"}}
      tasks:
        - task_key: main_task
          {{- if eq .compute_type "serverless"}}
          existing_cluster_id: ${var.serverless_cluster_id}
          {{- else}}
          job_cluster_key: main_cluster
          {{- end}}
          spark_python_task:
            python_file: ../src/task.py

      {{- else if eq .job_type "notebook"}}
      tasks:
        - task_key: notebook_task
          {{- if eq .compute_type "serverless"}}
          existing_cluster_id: ${var.serverless_cluster_id}
          {{- else}}
          job_cluster_key: main_cluster
          {{- end}}
          notebook_task:
            notebook_path: ../src/notebook.py

      {{- else if eq .job_type "dbt"}}
      tasks:
        - task_key: dbt_task
          {{- if eq .compute_type "serverless"}}
          existing_cluster_id: ${var.serverless_cluster_id}
          {{- else}}
          job_cluster_key: main_cluster
          {{- end}}
          dbt_task:
            project_directory: ../dbt
            commands:
              - "dbt run"

      {{- else if eq .job_type "spark_jar"}}
      tasks:
        - task_key: spark_jar_task
          {{- if eq .compute_type "serverless"}}
          existing_cluster_id: ${var.serverless_cluster_id}
          {{- else}}
          job_cluster_key: main_cluster
          {{- end}}
          spark_jar_task:
            main_class_name: com.{{.project_name}}.Main
          libraries:
            - jar: ../target/{{.project_name}}.jar
      {{- end}}

      {{- if eq .compute_type "classic"}}
      job_clusters:
        - job_cluster_key: main_cluster
          new_cluster:
            spark_version: {{template "spark_version" .}}
            node_type_id: {{template "node_type" .}}
            num_workers: {{template "num_workers" .}}
            {{- if eq .cloud_provider "aws"}}
            aws_attributes:
              availability: SPOT_WITH_FALLBACK
            {{- else if eq .cloud_provider "azure"}}
            azure_attributes:
              availability: SPOT_WITH_FALLBACK_AZURE
            {{- else if eq .cloud_provider "gcp"}}
            gcp_attributes:
              availability: PREEMPTIBLE_WITH_FALLBACK_GCP
            {{- end}}
      {{- end}}
{{- end}}
