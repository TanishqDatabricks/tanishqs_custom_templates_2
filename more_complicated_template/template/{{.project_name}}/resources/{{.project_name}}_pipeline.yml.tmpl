{{- if eq .include_pipeline "yes"}}
# Delta Live Tables Pipeline for {{.project_name}}
resources:
  pipelines:
    {{.project_name}}_pipeline:
      name: {{.project_name}}_pipeline
      target: {{.project_name}}_${bundle.target}

      {{- if eq .pipeline_language "python"}}
      libraries:
        - notebook:
            path: ../src/dlt_pipeline.py
      {{- else}}
      libraries:
        - notebook:
            path: ../src/dlt_pipeline.sql
      {{- end}}

      {{- if eq .compute_type "serverless"}}
      serverless: true
      {{- else}}
      clusters:
        - label: default
          num_workers: {{template "num_workers" .}}
          node_type_id: {{template "node_type" .}}
          {{- if eq .cloud_provider "aws"}}
          aws_attributes:
            availability: SPOT_WITH_FALLBACK
          {{- else if eq .cloud_provider "azure"}}
          azure_attributes:
            availability: SPOT_WITH_FALLBACK_AZURE
          {{- else if eq .cloud_provider "gcp"}}
          gcp_attributes:
            availability: PREEMPTIBLE_WITH_FALLBACK_GCP
          {{- end}}
      {{- end}}

      development: true
      continuous: false
      channel: CURRENT
{{- end}}
